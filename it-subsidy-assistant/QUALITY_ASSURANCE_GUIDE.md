# IT補助金アシスタント - 品質保証ガイド

## 🎯 概要

このドキュメントは、IT補助金アシスタントシステムの品質を保証し、安定した運用を実現するための包括的なガイドです。

## 📋 目次

1. [システム起動手順](#システム起動手順)
2. [品質監視システム](#品質監視システム)
3. [ゼロダウンタイム保証](#ゼロダウンタイム保証)
4. [セキュリティ対策](#セキュリティ対策)
5. [トラブルシューティング](#トラブルシューティング)
6. [運用チェックリスト](#運用チェックリスト)

## 🚀 システム起動手順

### ワンクリック起動

```bash
# システム全体を起動
./start.sh

# システムを停止
./stop.sh
```

### 起動時の自動チェック項目
- ✅ Node.js バージョン確認 (v16以上)
- ✅ 依存パッケージの自動インストール
- ✅ 環境変数の検証
- ✅ ポートの利用可能性確認
- ✅ ヘルスチェックの実行

## 📊 品質監視システム

### リアルタイム監視

```bash
# 監視ダッシュボードを起動
./monitor.sh
```

### 監視項目
1. **サービス状態**
   - Backend/Frontend の稼働状況
   - 応答時間のモニタリング
   - エラー率の追跡

2. **システムリソース**
   - CPU使用率
   - メモリ使用量
   - プロセス状態

3. **アラート機能**
   - 閾値超過時の自動通知
   - エラー多発時の警告
   - サービスダウン検知

### 監視コマンド
- `d` - 詳細表示
- `c` - 画面クリア
- `r` - 手動更新
- `q` - 終了

## 🛡️ ゼロダウンタイム保証

### 多層防御システム

1. **プロセス管理 (PM2)**
   ```javascript
   // ecosystem.config.js
   {
     instances: 2,           // クラスター化
     exec_mode: 'cluster',   // 負荷分散
     max_restarts: 10,       // 自動再起動
     autorestart: true       // クラッシュ時の自動復旧
   }
   ```

2. **エラーハンドリング**
   - Uncaught Exception の捕捉
   - Unhandled Rejection の処理
   - グレースフルシャットダウン

3. **サーキットブレーカー**
   - 外部サービス障害の隔離
   - 自動リトライ機能
   - フォールバック処理

### ヘルスモニター機能
```typescript
// 30秒ごとの自動ヘルスチェック
- データベース接続
- 外部API接続
- ディスクスペース
- メモリ使用率
```

## 🔐 セキュリティ対策

### APIキー管理

1. **ゼロ知識証明認証**
   - APIキーが送信されない
   - 暗号学的に安全な認証
   - 自動キーローテーション

2. **環境変数の保護**
   ```bash
   # .env.example を参考に設定
   JWT_SECRET=32文字以上のランダム文字列
   OPENAI_API_KEY=sk-で始まるAPIキー
   ```

3. **セキュリティチェックリスト**
   - [ ] JWT_SECRET は32文字以上
   - [ ] 本番環境では DEBUG=false
   - [ ] CORS設定の確認
   - [ ] HTTPSの使用（本番環境）

## 🔧 トラブルシューティング

### よくある問題と解決策

#### 1. ポートが使用中
```bash
# 使用中のポートを確認
lsof -i :3001
lsof -i :5173

# プロセスを停止
pm2 stop all
```

#### 2. 依存関係エラー
```bash
# キャッシュクリアして再インストール
rm -rf backend/node_modules frontend/node_modules
npm cache clean --force
./start.sh
```

#### 3. データベース接続エラー
- DATABASE_URL の確認
- Supabase の接続情報確認
- ネットワーク接続の確認

#### 4. PM2 プロセスエラー
```bash
# PM2 をリセット
pm2 kill
pm2 resurrect
```

### ログの確認方法
```bash
# リアルタイムログ
pm2 logs

# 特定サービスのログ
pm2 logs it-subsidy-backend
pm2 logs it-subsidy-frontend

# エラーログの確認
tail -f logs/backend-error.log
```

## ✅ 運用チェックリスト

### 日次チェック
- [ ] システムヘルスチェック (`./test-system.sh`)
- [ ] エラーログの確認
- [ ] リソース使用率の確認
- [ ] バックアップの確認

### 週次チェック
- [ ] セキュリティアップデートの確認
- [ ] パフォーマンスメトリクスのレビュー
- [ ] ログローテーションの確認
- [ ] 依存パッケージの更新確認

### 月次チェック
- [ ] 完全バックアップの実施
- [ ] セキュリティ監査
- [ ] パフォーマンスチューニング
- [ ] ドキュメントの更新

## 📈 パフォーマンス最適化

### 推奨設定
```javascript
// PM2 クラスター設定
instances: os.cpus().length  // CPUコア数に応じて調整

// メモリ制限
max_memory_restart: '500M'    // メモリリークの自動対処
```

### モニタリングツール
```bash
# PM2 モニター
pm2 monit

# システムリソース
htop

# ネットワーク
netstat -tulpn
```

## 🆘 緊急時対応

### システム完全停止時
1. `./stop.sh` で完全停止
2. ログを保存
3. `./start.sh` で再起動

### データ復旧
1. 最新のバックアップを確認
2. データベースの整合性チェック
3. 必要に応じてロールバック

### サポート連絡先
- 技術サポート: [support@it-subsidy.com]
- 緊急連絡先: [emergency@it-subsidy.com]

## 📝 更新履歴

- **v2.0** - ゼロダウンタイム保証機能追加
- **v1.5** - リアルタイム監視システム実装
- **v1.0** - 初回リリース

---

**最終更新日**: 2024年1月
**ドキュメントバージョン**: 2.0